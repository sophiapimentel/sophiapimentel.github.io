<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Gerador de Folha de Ponto</title>
  <link rel="shortcut icon" type="image/x-icon" href="https://sophiapimentel.github.io/sophia.jpg">

  <!-- jsPDF + html2canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body { font-family: Arial, Helvetica, sans-serif; background:#f4f6f8; padding:20px; color:#222; }
    .controls { display:flex; gap:8px; align-items:center; margin-bottom:12px; flex-wrap:wrap; }
    select, button { padding:6px 10px; font-size:14px; }
    .sheet { max-width:980px; margin:0 auto; background:#fff; padding:18px; box-shadow:0 2px 8px rgba(0,0,0,0.06); }
    .header { margin-bottom:0px; padding:6px 8px; border:1px solid #000; border-bottom:none; font-size:13px; }
    .header .title { font-weight:700; margin-bottom:6px; border-bottom: 1px solid #000; padding-bottom:6px; }
    .header-box { display:flex; justify-content:space-between; gap:12px; padding-bottom:20px }
    .header-left { font-size:13px; }
    .header-left strong { width:80px; display:inline-block; }
    .meta div { margin:2px 0; }
    .header-right { text-align:left; font-size:13px; }
    .header-right strong { width:75px; display:inline-block; }
    caption { caption-side:top; text-align:left; padding-bottom:6px; font-weight:600; font-size:13px;}
    #pontoTableDiv { overflow-x:auto }
    table { width:100%; border-collapse:collapse; font-size:13px; }
    th, td { border:1px solid #000; padding:6px 8px; text-align:center; vertical-align:middle; }
    th { background:#efefef; font-weight:700; }
    .col-day { width:30px; }
    .col-hour { width:80px; }
    .col-sign { width:200px; text-align:left; padding-left:10px; }
    .weekend { background:#fafafa; color:#999; }
    .notes { margin-top:10px; font-size:12px; color:#555; }
    .signature { margin-top:60px; display:flex; justify-content:space-between; align-items:center; }
    .sig-line { border-top:1px solid #333; width:320px; padding-top:6px; text-align:center; font-size:13px; }
    .small { font-size:12px; color:#666; }
  </style>
</head>
<body>
  <div class="controls">
    <label for="month">Mês:</label>
    <select id="month"></select>

    <label for="year">Ano:</label>
    <select id="year"></select>

    <button id="btnFill">Gerar</button>
    <button id="btnPDF">Gerar PDF</button>

    <div class="small" style="margin-left:auto;">Horário base: 08:00–12:00 e 13:00–17:48 (CH diária 8h48)</div>
  </div>

  <div id="printArea" class="sheet" role="region" aria-label="Folha de ponto">
    <div class="header" role="banner">
      <div class="title">Folha de ponto individual de funcionários</div>
      <div class="header-box">
        <div class="header-left">
          <div class="meta">
            <div><strong>Empresa:</strong> INSTITUTO OTOVIDA - CLINICA DE AUDICAO V</div>
            <div><strong>Atividade:</strong> Atividades de fonoaudiologia</div>
            <div><strong>Endereço:</strong> AV GOVERNADOR IVO SILVEIRA</div>
            <div><strong>Funcionário:</strong> 124 - SOPHIA PIMENTEL RODRIGUES</div>
            <div><strong>Cargo:</strong> 010 - FONOAUDIOLOGO (A)</div>
            <div><strong>Serviço:</strong> INSTITUTO OTOVIDA - CLINICA DE AUDICAO V</div>
            <div><strong>Horário:</strong> Segunda à Sexta 08:00 às 12:00 e das 13:00 às 17:48</div>
          </div>
        </div>

        <div class="header-right">
          <div><strong>Período:</strong> <span id="periodLabel">—</span></div>
          <div><strong>CNPJ/CPF:</strong> 04.045.814/0001-01</div>
          <div><strong>CTPS/Série:</strong> 1750972/8754</div>
          <div><strong>Depto:</strong> 001 - INSTITUTO OTOVIDA</div>
        </div>
      </div>
    </div>

    <div id="pontoTableDiv">
      <table id="pontoTable" aria-describedby="table-desc">
        <!-- <caption id="table-desc">Horário normal: Segunda à Sexta 08:00 às 12:00 e 13:00 às 17:48 — mínimo diário: 8h48 (528 min). Tolerância por marcação: ±3 minutos.</caption> -->
        <thead>
          <tr>
            <th rowspan="2" colspan="2">Dias</th>
            <th rowspan="1" colspan="4">Normal</th>
            <th rowspan="1" colspan="2">Extra</th>
            <th rowspan="2" colspan="1">Assinatura ou observações</th>
          </tr>
          <tr>
            <th>Entrada</th>
            <th colspan="2">Intervalo</th>
            <th>Saída</th>
            <th>Início</th>
            <th>Término</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- <div class="notes">
      Observações: geração com variações humanizadas. Colunas "Extra" mantidas vazias conforme solicitado.
    </div> -->

    <div class="signature">
      <div><strong>Data:</strong> <span id="generatedDate">—</span></div>
      <div class="sig-line">
        Assinatura do Funcionário
        <!-- <br/>
        <span style="font-size:12px;color:#666;">Assinatura do Funcionário</span> -->
      </div>
    </div>
  </div>

<script>
  // funções utilitárias
  const pad = n => String(n).padStart(2,'0');
  const toMin = (h,m) => h*60+m;
  const fromMin = min => pad(Math.floor(min/60))+':'+pad(Math.round(min%60));
  const rand = (min,max)=>Math.floor(Math.random()*(max-min+1))+min;

  const base = {
    e1: toMin(8,0),
    s1: toMin(12,0),
    e2: toMin(13,0),
    s2: toMin(17,48)
  };
  const MIN_DAILY = 8*60+48; // 528min

  const monthSelect = document.getElementById("month");
  const yearSelect  = document.getElementById("year");
  const months = ["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
  const now = new Date();

  months.forEach((m,i)=>{
    const opt=document.createElement("option");
    opt.value=i; opt.textContent=m;
    if(i===now.getMonth()) opt.selected=true;
    monthSelect.appendChild(opt);
  });
  for(let y=now.getFullYear()-2; y<=now.getFullYear()+2; y++){
    const opt=document.createElement("option");
    opt.value=y; opt.textContent=y;
    if(y===now.getFullYear()) opt.selected=true;
    yearSelect.appendChild(opt);
  }

  function gerarHorariosHumanizados(){
    let e1 = base.e1 + rand(-3,3);
    let s1 = base.s1 + rand(-3,3);
    let e2 = base.e2 + rand(-3,3);
    let s2 = base.s2 + rand(-3,3);

    // garantir intervalo >= 60 min
    if (e2 - s1 < 60) {
      e2 = s1 + 60 + rand(0,3);
    }

    let total = (s1 - e1) + (s2 - e2);
    if (total < MIN_DAILY) {
      s2 += (MIN_DAILY - total) + rand(0,3);
    }

    return [fromMin(e1), fromMin(s1), fromMin(e2), fromMin(s2)];
  }

  function gerarTabela(mes,ano){
    const tbody=document.querySelector("#pontoTable tbody");
    tbody.innerHTML="";
    const dias=new Date(ano,mes+1,0).getDate();
    for(let d=1;d<=dias;d++){
      const dt=new Date(ano,mes,d);
      const dow=dt.getDay();
      const tr=document.createElement("tr");
      const dia=String(pad(d));
      const diaName=["Dom","Seg","Ter","Qua","Qui","Sex","Sab"][dow];
      const tdDia=document.createElement("td");
      const tdDiaName=document.createElement("td");
      tdDia.textContent=dia;
      tdDia.className="col-day";
      tdDiaName.textContent=diaName;
      tdDiaName.className="col-day";
      tr.appendChild(tdDia);
      tr.appendChild(tdDiaName);

      if(dow===0 || dow===6){
        tr.classList.add("weekend");
        for(let i=0;i<4;i++){ const td=document.createElement("td"); tr.appendChild(td); }
        tr.appendChild(document.createElement("td"));
        tr.appendChild(document.createElement("td"));
        const tdObs=document.createElement("td");
        tdObs.className="col-sign";
        tdObs.textContent=(dow===0?"Domingo":"Sábado");
        tr.appendChild(tdObs);
      } else {
        const h=gerarHorariosHumanizados();
        h.forEach(v=>{
          const td=document.createElement("td");
          td.textContent=v;tr.appendChild(td);
          td.className="col-hour";
        });
        const tdEI=document.createElement("td");
        tdEI.className="col-hour";
        const tdEF=document.createElement("td");
        tdEF.className="col-hour";
        tr.appendChild(tdEI);
        tr.appendChild(tdEF);
        const tdObs=document.createElement("td");
        // tdObs.className="col-sign";
        tdObs.textContent="";
        tr.appendChild(tdObs);
      }
      tbody.appendChild(tr);
    }
    document.getElementById("periodLabel").textContent=`01/${pad(mes+1)}/${ano} a ${pad(dias)}/${pad(mes+1)}/${ano}`;
    document.getElementById("generatedDate").textContent= `${pad(dias)}/${pad(mes+1)}/${ano}`;
  }

  async function gerarPDF(){
    const el=document.getElementById("printArea");
    const canvas=await html2canvas(el,{scale:2});
    const img=canvas.toDataURL("image/png");
    const {jsPDF}=window.jspdf;
    const pdf=new jsPDF({orientation:"portrait",unit:"pt",format:"a4"});
    const pageWidth=pdf.internal.pageSize.getWidth();
    const imgWidth=pageWidth-40;
    const imgHeight=(canvas.height*imgWidth)/canvas.width;
    pdf.addImage(img,"PNG",20,20,imgWidth,imgHeight);
    pdf.save(`folha_ponto_${yearSelect.value}_${pad(+monthSelect.value+1)}.pdf`);
  }

  document.getElementById("btnFill").addEventListener("click",()=>{
    gerarTabela(+monthSelect.value,+yearSelect.value);
  });
  document.getElementById("btnPDF").addEventListener("click",gerarPDF);

  gerarTabela(now.getMonth(),now.getFullYear());
</script>
</body>
</html>
